<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3DEXPERIENCE RDF Vocabulary Validator & Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3ff6; }
        .error-row { background-color: #fee2e2 !important; }
        .warning-row { background-color: #fef3c7 !important; }
        /* Style for the custom input when dropdown is 'Other' */
        .custom-version-input {
            display: none;
            margin-top: 4px;
        }
    </style>
</head>
<body class="h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-blue-900 text-white p-4 shadow-md flex justify-between items-center">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-cube text-2xl"></i>
            <h1 class="text-xl font-semibold">3DEXPERIENCE RDF Vocabulary Manager</h1>
        </div>
        <div class="flex gap-2">
            <button onclick="clearAll()" class="bg-red-700 hover:bg-red-600 px-4 py-2 rounded text-sm transition">
                <i class="fa-solid fa-file-circle-plus mr-2"></i> New Vocabulary
            </button>
            <button onclick="document.getElementById('fileInput').click()" class="bg-blue-700 hover:bg-blue-600 px-4 py-2 rounded text-sm transition">
                <i class="fa-solid fa-upload mr-2"></i> Load RDF
            </button>
            <input type="file" id="fileInput" class="hidden" accept=".rdf,.xml" onchange="handleFileUpload(event)">
            
            <button onclick="exportRDF()" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded text-sm transition">
                <i class="fa-solid fa-download mr-2"></i> Export RDF
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex overflow-hidden">
        
        <!-- Left Panel: Raw Code & Status -->
        <div class="w-1/3 flex flex-col border-r border-gray-300 bg-white">
            <div class="p-3 bg-gray-100 border-b font-semibold text-gray-700 flex justify-between">
                <span>Validation Report</span>
                <span id="errorCount" class="bg-red-500 text-white text-xs px-2 py-1 rounded-full hidden">0 Issues</span>
            </div>
            <div id="validationReport" class="flex-1 overflow-y-auto p-4 space-y-3">
                <div class="text-gray-500 text-center mt-10 italic">Load a file to see validation results.</div>
            </div>
            
            <div class="p-3 bg-gray-100 border-t border-b font-semibold text-gray-700">
                Raw RDF Source
            </div>
            <textarea id="rawRdfInput" class="flex-1 w-full p-2 font-mono text-xs resize-none focus:outline-none" spellcheck="false"></textarea>
            <div class="p-2 bg-gray-50 border-t text-right">
                <button onclick="parseAndLoadFromText()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-xs">
                    Re-Analyze Text
                </button>
            </div>
        </div>

        <!-- Right Panel: Editor -->
        <div class="w-2/3 flex flex-col bg-gray-50">
            
            <!-- Metadata / Header Settings Section -->
            <div class="p-4 bg-white border-b shadow-sm">
                <h2 class="font-bold text-gray-800 mb-3 text-sm uppercase tracking-wide">Vocabulary Settings (Ontology Header)</h2>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">Vocabulary Name (Label)</label>
                        <input type="text" id="metaLabel" onchange="updateMeta('label', this.value)" class="w-full border rounded px-2 py-1 text-sm focus:border-blue-500 outline-none" placeholder="e.g. My Fastener Vocabulary">
                    </div>
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">Namespace URI (Base)</label>
                        <input type="text" id="metaNamespace" onchange="updateMeta('namespace', this.value)" class="w-full border rounded px-2 py-1 text-sm font-mono focus:border-blue-500 outline-none" placeholder="http://www.3ds.com/vocabularies/MyVocab/">
                    </div>
                    <!-- Version Info with Dropdown and Custom Input -->
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">Version Info</label>
                        <select id="metaVersionSelect" onchange="handleVersionChange(this.value)" class="w-full border rounded px-2 py-1 text-sm focus:border-blue-500 outline-none">
                            <option value="">(Select Version)</option>
                            <option value="R2024x">R2024x</option>
                            <option value="R2023x">R2023x</option>
                            <option value="R2022x">R2022x</option>
                            <option value="v1.0.0">v1.0.0 (Semantic)</option>
                            <option value="custom">Other (Custom)</option>
                        </select>
                        <input type="text" id="metaVersionCustom" oninput="updateMeta('version', this.value)" class="w-full border rounded px-2 py-1 text-sm focus:border-blue-500 outline-none custom-version-input" placeholder="Enter custom version info...">
                        <input type="hidden" id="metaVersion" value=""> <!-- Hidden input to hold the actual value for export -->
                    </div>
                    <!-- End Version Info -->
                    <div>
                        <label class="block text-xs font-semibold text-gray-600 mb-1">Description (Comment)</label>
                        <input type="text" id="metaComment" onchange="updateMeta('comment', this.value)" class="w-full border rounded px-2 py-1 text-sm focus:border-blue-500 outline-none" placeholder="Vocabulary description...">
                    </div>
                </div>
            </div>

            <div class="p-4 bg-gray-50 border-b flex justify-between items-center">
                <h2 class="font-bold text-gray-800 text-sm uppercase tracking-wide">Attributes (Predicates)</h2>
                <button onclick="addNewRow()" class="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 rounded text-sm shadow">
                    <i class="fa-solid fa-plus mr-1"></i> Add Attribute
                </button>
            </div>

            <div class="flex-1 overflow-auto p-4">
                <div class="bg-white rounded-lg shadow overflow-hidden">
                    <table class="w-full text-sm text-left">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100 border-b">
                            <tr>
                                <th class="px-4 py-3 w-1/5">ID (Predicate)</th>
                                <th class="px-4 py-3 w-1/4">Label (en)</th>
                                <th class="px-4 py-3 w-1/5">6W Dimension</th>
                                <th class="px-4 py-3 w-1/4">Comment</th>
                                <th class="px-4 py-3 w-12 text-center">Act</th>
                            </tr>
                        </thead>
                        <tbody id="attributesTable">
                            <!-- Rows generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

    </main>

<script>
// --- Initial Data (Sample RDF for demonstration, used on initial load) ---
const sampleRDF = `<?xml version="1.0"?>
<!DOCTYPE rdf:RDF [
  <!ENTITY owl "http://www.w3.org/2002/07/owl#" >
  <!ENTITY xml "http://www.w3.org/XML/1998/namespace" >
  <!ENTITY xsd "http://www.w3.org/2001/XMLSchema#" >
  <!ENTITY rdfs "http://www.w3.org/2000/01/rdf-schema#" >
  <!ENTITY rdf "http://www.w3.org/1999/02/22-rdf-syntax-ns#" >
  <!ENTITY ds6w "http://www.3ds.com/vocabularies/ds6w#" >
  <!ENTITY ELOP_Vocabulary "http://www.3ds.com/vocabularies/ELOP_Vocabulary/\" > 
]>

<rdf:RDF 
  xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
  xmlns:xml="http://www.w3.org/XML/1998/namespace"
  xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:owl="http://www.w3.org/2002/07/owl#"
  xmlns:ds6w="http://www.3ds.com/vocabularies/ds6w#"
  xmlns:ELOP_Vocabulary="http://www.3ds.com/vocabularies/ELOP_Vocabulary/"
  xml:base="http://www.3ds.com/vocabularies/ELOP_Vocabulary/">
  
  <owl:Ontology rdf:about="http://www.3ds.com/vocabularies/ELOP_Vocabulary/">
	  <rdfs:label xml:lang="en">ELOP_Vocabulary attributes 6wtaggs Vocabulary</rdfs:label>
	  <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">This ontology defines the vocabulary related to Elop Predicates for the 3DExperience Tagger.</rdfs:comment>
	  <owl:versionInfo>R2021x</owl:versionInfo>
	  <owl:imports rdf:resource="ds6w"/>							
  </owl:Ontology>
  
  <owl:DatatypeProperty rdf:about="Commodity">
	  <rdfs:label xml:lang="en">Commodity</rdfs:label>
	  <rdfs:subPropertyOf rdf:resource="&ds6w;what"/>
	  <rdfs:range rdf:resource="&xsd;string"/>
	  <rdfs:comment xml:lang="en">English desciption of the Commodity predicate</rdfs:comment>
  </owl:DatatypeProperty> 

  <owl:DatatypeProperty rdf:about="VendorName">
	  <rdfs:label xml:lang="en">VendorName</rdfs:label>
	  <rdfs:subPropertyOf rdf:resource="&ds6w;who"/>
	  <rdfs:range rdf:resource="&xsd;string"/>
	  <rdfs:comment xml:lang="en">English desciption of the Vendor Name predicate</rdfs:comment>
  </owl:DatatypeProperty>  
   
</rdf:RDF>`;

// --- Application Logic ---

let globalParsedData = [];
let globalOntologyMeta = {
    label: "",
    namespace: "",
    version: "", // Will hold the final version string
    comment: ""
};

document.addEventListener("DOMContentLoaded", () => {
    document.getElementById('rawRdfInput').value = sampleRDF;
    parseAndLoadFromText();
});

// Function to reset the application state to a blank vocabulary
function clearAll() {
    // Reset Metadata
    globalOntologyMeta = {
        label: "New_Vocabulary",
        namespace: "http://www.3ds.com/vocabularies/NewVocab/",
        version: "v1.0",
        comment: "A new vocabulary created from scratch."
    };
    
    // Reset Attributes
    globalParsedData = [];

    // Update UI elements
    document.getElementById('metaLabel').value = globalOntologyMeta.label;
    document.getElementById('metaNamespace').value = globalOntologyMeta.namespace;
    document.getElementById('metaComment').value = globalOntologyMeta.comment;
    
    // Reset Version Select
    const versionSelect = document.getElementById('metaVersionSelect');
    const versionCustom = document.getElementById('metaVersionCustom');
    versionSelect.value = 'v1.0.0'; // Set default semantic version
    versionCustom.value = '';
    versionCustom.style.display = 'none';
    document.getElementById('metaVersion').value = 'v1.0.0'; // Update hidden value
    
    // Clear raw input and report
    document.getElementById('rawRdfInput').value = `<?xml version="1.0"?>\n<rdf:RDF></rdf:RDF>`;
    document.getElementById("validationReport").innerHTML = '<div class="text-gray-500 text-center mt-10 italic">Workspace cleared. Start adding attributes!</div>';
    document.getElementById("errorCount").textContent = "Ready to Build";
    document.getElementById("errorCount").classList.remove("hidden", "bg-red-500", "bg-yellow-500", "bg-green-500");
    document.getElementById("errorCount").classList.add("bg-blue-500");

    renderTable();
}


function handleFileUpload(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            document.getElementById('rawRdfInput').value = e.target.result;
            parseAndLoadFromText();
        };
        reader.readAsText(file);
    }
}

function handleVersionChange(value) {
    const customInput = document.getElementById('metaVersionCustom');
    const hiddenInput = document.getElementById('metaVersion');
    
    if (value === 'custom') {
        customInput.style.display = 'block';
        customInput.focus();
        // Set the hidden value to the custom input's value for export
        hiddenInput.value = customInput.value; 
    } else {
        customInput.style.display = 'none';
        hiddenInput.value = value;
    }
    updateMeta('version', hiddenInput.value);
}

function parseAndLoadFromText() {
    const text = document.getElementById('rawRdfInput').value;
    const parser = new DOMParser();
    
    // Simple preprocessing to handle entities
    let preprocessedText = text
        .replace(/&ds6w;/g, "http://www.3ds.com/vocabularies/ds6w#")
        .replace(/&xsd;/g, "http://www.w3.org/2001/XMLSchema#");

    const xmlDoc = parser.parseFromString(preprocessedText, "text/xml");
    const parseError = xmlDoc.querySelector("parsererror");
    
    if (parseError) {
        reportIssue("XML Syntax Error: " + parseError.textContent, 'critical');
        document.getElementById('rawRdfInput').style.borderColor = 'red';
        return;
    }
    document.getElementById('rawRdfInput').style.borderColor = '';

    // --- Parse Ontology Metadata ---
    const rdfTag = xmlDoc.getElementsByTagName("rdf:RDF")[0];
    if (rdfTag && rdfTag.getAttribute("xml:base")) {
        globalOntologyMeta.namespace = rdfTag.getAttribute("xml:base");
    }

    const ontologyTag = xmlDoc.getElementsByTagName("owl:Ontology")[0];
    if (ontologyTag) {
        // If rdf:about exists, it usually matches namespace
        if (ontologyTag.getAttribute("rdf:about")) {
            globalOntologyMeta.namespace = ontologyTag.getAttribute("rdf:about");
        }
        
        const labelNode = ontologyTag.getElementsByTagName("rdfs:label")[0];
        if (labelNode) globalOntologyMeta.label = labelNode.textContent;

        const commentNode = ontologyTag.getElementsByTagName("rdfs:comment")[0];
        if (commentNode) globalOntologyMeta.comment = commentNode.textContent;

        const versionNode = ontologyTag.getElementsByTagName("owl:versionInfo")[0];
        if (versionNode) globalOntologyMeta.version = versionNode.textContent;
    } else {
        // Handle case where RDF is valid XML but missing Ontology header (common for scratch files)
        globalOntologyMeta.label = "Missing Ontology Header";
        globalOntologyMeta.comment = "Please manually add a label, version, and namespace.";
        globalOntologyMeta.version = "N/A";
        reportIssue("Ontology header (<owl:Ontology>) missing in the loaded RDF. Using default metadata.", "warning");
    }

    // Populate Metadata Inputs
    document.getElementById('metaLabel').value = globalOntologyMeta.label;
    document.getElementById('metaNamespace').value = globalOntologyMeta.namespace;
    document.getElementById('metaComment').value = globalOntologyMeta.comment;

    // Handle Version Info population
    const versionSelect = document.getElementById('metaVersionSelect');
    const versionCustom = document.getElementById('metaVersionCustom');
    const currentVersion = globalOntologyMeta.version;
    document.getElementById('metaVersion').value = currentVersion;

    // Check if the current version matches any dropdown option
    let match = false;
    for (let i = 0; i < versionSelect.options.length; i++) {
        if (versionSelect.options[i].value === currentVersion) {
            versionSelect.value = currentVersion;
            versionCustom.style.display = 'none';
            versionCustom.value = '';
            match = true;
            break;
        }
    }
    
    // If no match, set to 'Other (Custom)'
    if (!match) {
        versionSelect.value = 'custom';
        versionCustom.value = currentVersion;
        versionCustom.style.display = 'block';
    }


    // --- Parse Attributes ---
    globalParsedData = [];
    const props = xmlDoc.getElementsByTagName("owl:DatatypeProperty");
    
    for (let i = 0; i < props.length; i++) {
        const prop = props[i];
        
        let id = prop.getAttribute("rdf:about");
        // Remove namespace from ID if present
        if (id && id.startsWith(globalOntologyMeta.namespace)) {
            id = id.replace(globalOntologyMeta.namespace, "");
        }
        
        // Labels
        let label = "";
        const labelNode = prop.getElementsByTagName("rdfs:label")[0];
        if (labelNode) label = labelNode.textContent;

        // 6W Type
        let type = "ds6w:what"; // Default
        const subPropNode = prop.getElementsByTagName("rdfs:subPropertyOf")[0];
        if (subPropNode) {
            let res = subPropNode.getAttribute("rdf:resource");
            // Check for full URI or entity reference
            if(res && res.includes("who")) type = "ds6w:who";
            else if(res && res.includes("when")) type = "ds6w:when";
            else if(res && res.includes("where")) type = "ds6w:where";
            else if(res && res.includes("why")) type = "ds6w:why";
            else if(res && res.includes("how")) type = "ds6w:how";
            else type = "ds6w:what";
        }

        // Comment
        let comment = "";
        const commentNode = prop.getElementsByTagName("rdfs:comment")[0];
        if (commentNode) comment = commentNode.textContent;

        globalParsedData.push({ id, label, type, comment });
    }

    renderTable();
    runValidation();
}

function updateMeta(field, value) {
    globalOntologyMeta[field] = value;
    if (field === 'version') {
        document.getElementById('metaVersion').value = value;
    }
}

function renderTable() {
    const tbody = document.getElementById('attributesTable');
    tbody.innerHTML = "";

    if (globalParsedData.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500 italic">No attributes defined. Click "Add Attribute" above to begin.</td></tr>';
        return;
    }

    globalParsedData.forEach((item, index) => {
        const tr = document.createElement("tr");
        tr.className = "border-b hover:bg-gray-50 transition";
        tr.id = `row-${index}`;
        
        tr.innerHTML = `
            <td class="px-4 py-2">
                <input type="text" value="${item.id}" onchange="updateData(${index}, 'id', this.value)" class="w-full bg-transparent border-b border-dashed border-gray-300 focus:border-blue-500 outline-none">
            </td>
            <td class="px-4 py-2">
                <input type="text" value="${item.label}" onchange="updateData(${index}, 'label', this.value)" class="w-full bg-transparent border-b border-dashed border-gray-300 focus:border-blue-500 outline-none">
            </td>
            <td class="px-4 py-2">
                <select onchange="updateData(${index}, 'type', this.value)" class="w-full bg-transparent text-gray-700 outline-none">
                    <option value="ds6w:what" ${item.type === 'ds6w:what' ? 'selected' : ''}>What (Content)</option>
                    <option value="ds6w:who" ${item.type === 'ds6w:who' ? 'selected' : ''}>Who (People)</option>
                    <option value="ds6w:where" ${item.type === 'ds6w:where' ? 'selected' : ''}>Where (Location)</option>
                    <option value="ds6w:when" ${item.type === 'ds6w:when' ? 'selected' : ''}>When (Time)</option>
                    <option value="ds6w:why" ${item.type === 'ds6w:why' ? 'selected' : ''}>Why (Reason)</option>
                    <option value="ds6w:how" ${item.type === 'ds6w:how' ? 'selected' : ''}>How (Method)</option>
                </select>
            </td>
            <td class="px-4 py-2">
                <input type="text" value="${item.comment}" onchange="updateData(${index}, 'comment', this.value)" class="w-full bg-transparent border-b border-dashed border-gray-300 focus:border-blue-500 outline-none text-gray-500 italic">
            </td>
            <td class="px-4 py-2 text-center">
                <button onclick="deleteRow(${index})" class="text-red-500 hover:text-red-700"><i class="fa-solid fa-trash"></i></button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function updateData(index, field, value) {
    globalParsedData[index][field] = value;
    runValidation();
}

function deleteRow(index) {
    globalParsedData.splice(index, 1);
    renderTable();
    runValidation();
}

function addNewRow() {
    globalParsedData.push({
        id: `NewAttribute${globalParsedData.length + 1}`,
        label: "New Attribute",
        type: "ds6w:what",
        comment: "Description here"
    });
    renderTable();
    runValidation();
}

function runValidation() {
    const reportDiv = document.getElementById("validationReport");
    reportDiv.innerHTML = "";
    let errorCount = 0;
    let warningCount = 0;
    
    // Clear previous highlights
    document.querySelectorAll("tr").forEach(tr => tr.classList.remove("error-row", "warning-row"));

    const ids = {};
    
    // Check Duplicates and Empty IDs
    globalParsedData.forEach((item, index) => {
        if (!item.id || item.id.trim() === "") {
            errorCount++;
            reportIssue(`Attribute at row ${index + 1} has an empty ID (rdf:about).`, "critical");
            const row = document.getElementById(`row-${index}`);
            if (row) row.classList.add("error-row");
        } else if (ids[item.id]) {
            ids[item.id].push(index);
        } else {
            ids[item.id] = [index];
        }

        // Check typos
        if (item.comment.includes("desciption")) {
            warningCount++;
            reportIssue("Typo detected: 'desciption' in a comment field. (Should be 'description')", "warning");
        }
    });

    // Report Duplicates
    Object.keys(ids).forEach(id => {
        if (ids[id].length > 1) {
            errorCount++;
            reportIssue(`Duplicate Attribute ID found: <strong>${id}</strong>. Used on rows ${ids[id].map(i => i + 1).join(', ')}.`, "critical");
            ids[id].forEach(rowIndex => {
                const row = document.getElementById(`row-${rowIndex}`);
                if (row) row.classList.add("error-row");
            });
        }
    });
    
    // Check Imports (Warning if the raw text is loaded with bad imports)
    const rawText = document.getElementById('rawRdfInput').value;
    if(rawText.includes('<owl:imports rdf:resource="ds6w"/>')) {
        warningCount++;
        reportIssue(`Invalid owl:imports reference: "ds6w" is often wrong. It should be the full URI: "http://www.3ds.com/vocabularies/ds6w"`, "warning");
    }

    const badge = document.getElementById("errorCount");
    badge.classList.remove("hidden", "bg-red-500", "bg-yellow-500", "bg-green-500", "bg-blue-500");

    if (errorCount > 0) {
        badge.textContent = `${errorCount} Critical Issues`;
        badge.classList.add("bg-red-500");
    } else if (warningCount > 0) {
        badge.textContent = `${warningCount} Warnings`;
        badge.classList.add("bg-yellow-500");
    } else if (globalParsedData.length > 0) {
        badge.textContent = "RDF Valid";
        badge.classList.add("bg-green-500");
    } else {
        badge.textContent = "Ready to Build";
        badge.classList.add("bg-blue-500");
    }

    if (errorCount === 0 && warningCount === 0 && globalParsedData.length === 0) {
        reportDiv.innerHTML = '<div class="text-gray-500 text-center mt-10 italic">No issues found. Add attributes or load a file.</div>';
    }

}

function reportIssue(msg, type) {
    const reportDiv = document.getElementById("validationReport");
    const div = document.createElement("div");
    const color = type === 'critical' ? 'text-red-700 bg-red-100 border-red-300' : 'text-yellow-800 bg-yellow-100 border-yellow-300';
    const icon = type === 'critical' ? '<i class="fa-solid fa-circle-exclamation mr-2"></i>' : '<i class="fa-solid fa-triangle-exclamation mr-2"></i>';
    
    div.className = `p-3 rounded border text-sm ${color}`;
    div.innerHTML = `${icon} ${msg}`;
    reportDiv.appendChild(div);
}

function exportRDF() {
    // Get the final version string from the hidden input
    const finalVersion = document.getElementById('metaVersion').value || globalOntologyMeta.version;
    const finalLabel = document.getElementById('metaLabel').value || globalOntologyMeta.label || "Untitled Vocabulary";
    const finalNamespace = document.getElementById('metaNamespace').value || globalOntologyMeta.namespace || "http://www.3ds.com/vocabularies/default/";
    const finalComment = document.getElementById('metaComment').value || globalOntologyMeta.comment || "Generated by the RDF Vocabulary Manager.";

    // Reconstruct XML with fixed header values from settings
    let rdf = `<?xml version="1.0"?>
<!DOCTYPE rdf:RDF [
  <!ENTITY owl "http://www.w3.org/2002/07/owl#" >
  <!ENTITY xml "http://www.w3.org/XML/1998/namespace" >
  <!ENTITY xsd "http://www.w3.org/2001/XMLSchema#" >
  <!ENTITY rdfs "http://www.w3.org/2000/01/rdf-schema#" >
  <!ENTITY rdf "http://www.w3.org/1999/02/22-rdf-syntax-ns#" >
  <!ENTITY ds6w "http://www.3ds.com/vocabularies/ds6w#" >
]>

<rdf:RDF 
  xmlns:xsd="http://www.w3.org/2001/XMLSchema#"
  xmlns:xml="http://www.w3.org/XML/1998/namespace"
  xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
  xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#"
  xmlns:owl="http://www.w3.org/2002/07/owl#"
  xmlns:ds6w="http://www.3ds.com/vocabularies/ds6w#"
  xml:base="${finalNamespace}">
  
  <owl:Ontology rdf:about="${finalNamespace}">
    <rdfs:label xml:lang="en">${finalLabel}</rdfs:label>
    <rdfs:comment rdf:datatype="http://www.w3.org/2001/XMLSchema#string">${finalComment}</rdfs:comment>
    <owl:versionInfo>${finalVersion}</owl:versionInfo>
    <owl:imports rdf:resource="http://www.3ds.com/vocabularies/ds6w"/>
  </owl:Ontology>
`;

    globalParsedData.forEach(item => {
        // Map simplified 6W selection back to URI
        const parentResource = `&ds6w;${item.type.split(':')[1]}`;
        
        rdf += `
  <owl:DatatypeProperty rdf:about="${item.id}">
      <rdfs:label xml:lang="en">${item.label}</rdfs:label>
      <rdfs:subPropertyOf rdf:resource="${parentResource}"/>
      <rdfs:range rdf:resource="&xsd;string"/>
      <rdfs:comment xml:lang="en">${item.comment}</rdfs:comment>
  </owl:DatatypeProperty>
`;
    });

    rdf += `\n</rdf:RDF>`;

    // Download Logic
    const blob = new Blob([rdf], { type: "application/rdf+xml" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${finalLabel.replace(/[^a-zA-Z0-9]/g, '_')}.rdf`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
}
</script>
</body>
</html>